


ARM Macro Assembler    Page 1 


    1 00000000                 AREA             interrupts, CODE, READWRITE
    2 00000000         
    3 00000000                 EXPORT           lab6
    4 00000000         
    5 00000000                 EXPORT           FIQ_Handler
    6 00000000         
    7 00000000                 EXTERN           uart_init
    8 00000000                 EXTERN           pin_connect_block_setup_for_uar
t0
    9 00000000                 EXTERN           setup_pins
   10 00000000                 EXTERN           validate_input
   11 00000000                 EXTERN           change_display
   12 00000000                 EXTERN           clear_display
   13 00000000                 EXTERN           toggle_seven_seg
   14 00000000                 EXTERN           read_character
   15 00000000                 EXTERN           output_character
   16 00000000                 EXTERN           output_string
   17 00000000                 EXTERN           new_line
   18 00000000         
   19 00000000                 EXTERN           change_display_digit
   20 00000000                 EXTERN           get_digit
   21 00000000         
   22 00000000                 EXTERN           from_ascii
   23 00000000         
   24 00000000                 EXTERN           store_input
   25 00000000         
   26 00000000 50 72 65 
              73 73 20 
              6D 6F 6D 
              65 6E 74 
              61 72 79 
              20 70 75 
              73 68 20 
              62 75 74 
              74 6F 6E 
              20 74 6F 
              20 74 6F 
              67 67 6C 
              65 20 73 
              65 76 65 
              6E 20 73 
              65 67 6D 
              65 6E 74 
              20 64 69 
              73 70 6C 
              61 79 20 
              6F 6E 20 
              6F 72 20 
              6F 66 66 
              2E 20 45 
              6E 74 65 
              72 20 66 
              6F 75 72 
              20 68 65 
              78 61 64 
              65 63 69 
              6D 61 6C 
              20 6E 75 
              6D 62 65 



ARM Macro Assembler    Page 2 


              72 73 2C 
              20 66 6F 
              6C 6C 6F 
              77 65 64 
              20 62 79 
              20 5B 45 
              6E 74 65 
              72 5D 2C 
              20 74 6F 
              20 63 68 
              61 6E 67 
              65 20 74 
              68 65 20 
              64 69 73 
              70 6C 61 
              79 20 28 
              69 66 20 
              69 74 20 
              69 73 20 
              6F 6E 29 
              2E 20 50 
              72 65 73 
              73 20 27 
              71 27 20 
              74 6F 20 
              65 78 69 
              74 20 70 
              72 6F 67 
              72 61 6D 
              2E 00    prompt  =                "Press momentary push button to
 toggle seven segment display on or off. Enter four hexadecimal numbers, follow
ed by [Enter], to change the display (if it is on). Press 'q' to exit program."
,0
   27 000000BC 74 65 73 
              74 31 00 test    =                "test1",0
   28 000000C2 00 00           ALIGN
   29 000000C4         
   30 000000C4         lab6
   31 000000C4         
   32 000000C4 E92D4000        STMFD            sp!, {lr}
   33 000000C8         
   34 000000C8 EBFFFFFE        BL               uart_init   ;setup the uart wit
                                                            h its init subrouti
                                                            ne
   35 000000CC EBFFFFFE        BL               pin_connect_block_setup_for_uar
t0 
                                                            ;setup the pin conn
                                                            ect block
   36 000000D0 EBFFFFFE        BL               setup_pins  ;setup pins require
                                                            d for momentary pus
                                                            h button and seven 
                                                            segment display 
   37 000000D4 EB000009        BL               interrupt_init
   38 000000D8 EBFFFFFE        BL               clear_display
   39 000000DC         
   40 000000DC E3A09000        MOV              r9, #0
   41 000000E0         
   42 000000E0 E3A08002        MOV              r8, #2
   43 000000E4         



ARM Macro Assembler    Page 3 


   44 000000E4 E59F4208        LDR              r4, =prompt
   45 000000E8         
   46 000000E8 EBFFFFFE        BL               output_string
   47 000000EC         
   48 000000EC         lab6_loop
   49 000000EC         
   50 000000EC E3570005        CMP              r7, #5
   51 000000F0 AA000000        BGE              lab6_end
   52 000000F4         
   53 000000F4 EAFFFFFC        B                lab6_loop
   54 000000F8         
   55 000000F8         lab6_end
   56 000000F8         
   57 000000F8 E8BD4000        LDMFD            sp!,{lr}
   58 000000FC         
   59 000000FC E12FFF1E        BX               lr
   60 00000100         
   61 00000100         
   62 00000100         
   63 00000100         interrupt_init
   64 00000100         
   65 00000100 E92D4007        STMFD            SP!, {r0-r2, lr} 
                                                            ; Save registers 
   66 00000104         
   67 00000104         
   68 00000104         
   69 00000104         ; Push button setup   
   70 00000104         
   71 00000104 E59F01EC        LDR              r0, =0xE002C000
   72 00000108         
   73 00000108 E5901000        LDR              r1, [r0]
   74 0000010C         
   75 0000010C E3811202        ORR              r1, r1, #0x20000000
   76 00000110         
   77 00000110 E3C11201        BIC              r1, r1, #0x10000000
   78 00000114         
   79 00000114 E5801000        STR              r1, [r0]    ; PINSEL0 bits 29:2
                                                            8 = 10
   80 00000118         
   81 00000118         
   82 00000118         ;key board setup
   83 00000118 E59F01DC        LDR              r0, =0xE000C004
   84 0000011C         
   85 0000011C E5901000        LDR              r1, [r0]
   86 00000120         
   87 00000120 E3811001        ORR              r1, r1, #0x1
   88 00000124         
   89 00000124 E5801000        STR              r1, [r0]
   90 00000128         
   91 00000128         
   92 00000128         ; Classify sources as IRQ or FIQ
   93 00000128         
   94 00000128 E59F01D0        LDR              r0, =0xFFFFF000
   95 0000012C         
   96 0000012C E590100C        LDR              r1, [r0, #0xC]
   97 00000130         
   98 00000130 E59F21CC        LDR              r2, =0x8050
   99 00000134         
  100 00000134 E1811002        ORR              r1, r1, r2  ; External Interrup



ARM Macro Assembler    Page 4 


                                                            t 1
  101 00000138         
  102 00000138 E580100C        STR              r1, [r0, #0xC]
  103 0000013C         
  104 0000013C         
  105 0000013C         
  106 0000013C         ; Enable Interrupts
  107 0000013C         
  108 0000013C E59F01BC        LDR              r0, =0xFFFFF000
  109 00000140         
  110 00000140 E5901010        LDR              r1, [r0, #0x10]
  111 00000144         
  112 00000144 E59F21B8        LDR              r2, =0x8050
  113 00000148         
  114 00000148 E1811002        ORR              r1, r1, r2  ; External Interrup
                                                            t 1
  115 0000014C         
  116 0000014C E5801010        STR              r1, [r0, #0x10]
  117 00000150         
  118 00000150         
  119 00000150         
  120 00000150         ; External Interrupt 1 setup for edge sensitive
  121 00000150         
  122 00000150 E59F01B0        LDR              r0, =0xE01FC148
  123 00000154         
  124 00000154 E5901000        LDR              r1, [r0]
  125 00000158         
  126 00000158 E3811002        ORR              r1, r1, #2  ; EINT1 = Edge Sens
                                                            itive
  127 0000015C         
  128 0000015C E5801000        STR              r1, [r0]
  129 00000160         
  130 00000160         ; External Timer 0 modify MR0
  131 00000160         
  132 00000160 E59F01A4        LDR              r0, =0xE0004018
  133 00000164         
  134 00000164 E59F11A4        LDR              r1, =160000
  135 00000168         
  136 00000168 E5801000        STR              r1, [r0]
  137 0000016C         
  138 0000016C         
  139 0000016C         ; External Timer 0 MCR
  140 0000016C         
  141 0000016C E59F01A0        LDR              r0, =0xE0004014
  142 00000170         
  143 00000170 E5901000        LDR              r1, [r0]
  144 00000174         
  145 00000174         ;ORR r1, r1, #3
  146 00000174         ;ORR r1, r1, #8
  147 00000174 E3811003        ORR              r1, r1, #0x3
  148 00000178 E3C11020        BIC              r1, r1, #0x20
  149 0000017C         
  150 0000017C E5801000        STR              r1, [r0]
  151 00000180         
  152 00000180         ; External Timer 0 timer control register
  153 00000180         
  154 00000180 E59F0190        LDR              r0, =0xE0004004
  155 00000184         
  156 00000184 E5901000        LDR              r1, [r0]



ARM Macro Assembler    Page 5 


  157 00000188         
  158 00000188 E3811001        ORR              r1, r1, #1
  159 0000018C         
  160 0000018C E5801000        STR              r1, [r0]
  161 00000190         
  162 00000190         ; Enable FIQ's, Disable IRQ's
  163 00000190         
  164 00000190 E10F0000        MRS              r0, CPSR
  165 00000194         
  166 00000194 E3C00040        BIC              r0, r0, #0x40
  167 00000198         
  168 00000198 E3800080        ORR              r0, r0, #0x80
  169 0000019C         
  170 0000019C E121F000        MSR              CPSR_c, r0
  171 000001A0         
  172 000001A0         
  173 000001A0         
  174 000001A0 E8BD4007        LDMFD            SP!, {r0-r2, lr} 
                                                            ; Restore registers
                                                            
  175 000001A4         
  176 000001A4 E12FFF1E        BX               lr          ; Return
  177 000001A8         
  178 000001A8         FIQ_Handler
  179 000001A8         
  180 000001A8 E92D401F        STMFD            SP!, {r0, r1, r2, r3, r4, lr} 
                                                            ; Save registers
  181 000001AC         
  182 000001AC E59F0168        LDR              r0, =0xE0004000
  183 000001B0 E5901000        LDR              r1, [r0]
  184 000001B4 E3510000        CMP              r1, #0
  185 000001B8 CA000000        BGT              TIMER0
  186 000001BC EA00002C        B                EINT1
  187 000001C0         
  188 000001C0         TIMER0
  189 000001C0         
  190 000001C0 E3811001        ORR              r1, r1, #1
  191 000001C4 E5801000        STR              r1, [r0]
  192 000001C8         
  193 000001C8         ;r8 contains value to display
  194 000001C8         
  195 000001C8 E3590001        CMP              r9, #1
  196 000001CC 1A000046        BNE              FIQ_Exit
  197 000001D0         
  198 000001D0 E3570000        CMP              r7, #0
  199 000001D4 0A000006        BEQ              cycle_1
  200 000001D8         
  201 000001D8 E3570001        CMP              r7, #1
  202 000001DC 0A00000C        BEQ              cycle_2
  203 000001E0         
  204 000001E0 E3570002        CMP              r7, #2
  205 000001E4 0A000012        BEQ              cycle_3
  206 000001E8         
  207 000001E8 E3570003        CMP              r7, #3
  208 000001EC 0A000018        BEQ              cycle_4
  209 000001F0         
  210 000001F0 EA00003D        B                FIQ_Exit
  211 000001F4         
  212 000001F4         cycle_1



ARM Macro Assembler    Page 6 


  213 000001F4         
  214 000001F4 EBFFFFFE        BL               clear_display
  215 000001F8         
  216 000001F8 E3A00000        MOV              r0, #0
  217 000001FC EBFFFFFE        BL               get_digit
  218 00000200         
  219 00000200 E1A04000        MOV              r4, r0
  220 00000204 E3A00001        MOV              r0, #1
  221 00000208         
  222 00000208 EBFFFFFE        BL               change_display_digit
  223 0000020C         
  224 0000020C E2877001        ADD              r7, r7, #1
  225 00000210         
  226 00000210 EA000035        B                FIQ_Exit
  227 00000214         
  228 00000214         cycle_2
  229 00000214         
  230 00000214 EBFFFFFE        BL               clear_display
  231 00000218         
  232 00000218 E3A00001        MOV              r0, #1
  233 0000021C EBFFFFFE        BL               get_digit
  234 00000220         
  235 00000220 E1A04000        MOV              r4, r0
  236 00000224 E3A00001        MOV              r0, #1
  237 00000228         
  238 00000228 EBFFFFFE        BL               change_display_digit
  239 0000022C         
  240 0000022C E2877001        ADD              r7, r7, #1
  241 00000230         
  242 00000230 EA00002D        B                FIQ_Exit
  243 00000234         
  244 00000234         cycle_3
  245 00000234         
  246 00000234 EBFFFFFE        BL               clear_display
  247 00000238         
  248 00000238 E3A00002        MOV              r0, #2
  249 0000023C EBFFFFFE        BL               get_digit
  250 00000240         
  251 00000240 E1A04000        MOV              r4, r0
  252 00000244 E3A00002        MOV              r0, #2
  253 00000248         
  254 00000248 EBFFFFFE        BL               change_display_digit
  255 0000024C         
  256 0000024C E2877001        ADD              r7, r7, #1
  257 00000250         
  258 00000250 EA000025        B                FIQ_Exit
  259 00000254         
  260 00000254         cycle_4
  261 00000254         
  262 00000254 EBFFFFFE        BL               clear_display
  263 00000258         
  264 00000258 E3A00003        MOV              r0, #3
  265 0000025C EBFFFFFE        BL               get_digit
  266 00000260         
  267 00000260 E1A04000        MOV              r4, r0
  268 00000264 E3A00003        MOV              r0, #3
  269 00000268         
  270 00000268 EBFFFFFE        BL               change_display_digit
  271 0000026C         



ARM Macro Assembler    Page 7 


  272 0000026C E3A07000        MOV              r7, #0
  273 00000270         
  274 00000270 EA00001D        B                FIQ_Exit
  275 00000274         
  276 00000274         EINT1                                ; Check for EINT1 i
                                                            nterrupt
  277 00000274         
  278 00000274         
  279 00000274 E59F00A4        LDR              r0, =0xE01FC140
  280 00000278         
  281 00000278 E5901000        LDR              r1, [r0]
  282 0000027C         
  283 0000027C E3110002        TST              r1, #2
  284 00000280         
  285 00000280 0A000003        BEQ              FIQ_Keys
  286 00000284         
  287 00000284 EBFFFFFE        BL               toggle_seven_seg
  288 00000288         
  289 00000288 E3811002        ORR              r1, r1, #2  ; Clear Interrupt
  290 0000028C         
  291 0000028C E5801000        STR              r1, [r0]
  292 00000290         
  293 00000290 EA000015        B                FIQ_Exit
  294 00000294         
  295 00000294         FIQ_Keys
  296 00000294         
  297 00000294 E59F0088        LDR              r0, =0xE000C008
  298 00000298         
  299 00000298 E5901000        LDR              r1, [r0]
  300 0000029C         
  301 0000029C E2012001        AND              r2, r1, #1
  302 000002A0         
  303 000002A0 E3520000        CMP              r2, #0
  304 000002A4         
  305 000002A4 1A000010        BNE              FIQ_Exit
  306 000002A8         
  307 000002A8 EBFFFFFE        BL               read_character
  308 000002AC EBFFFFFE        BL               validate_input
  309 000002B0         
  310 000002B0 E3540001        CMP              r4, #1      ;is input valid?
  311 000002B4 1A00000C        BNE              quit_skip   ;branch away if not
                                                            
  312 000002B8         
  313 000002B8 E3500071        CMP              r0, #0x71
  314 000002BC 0A00000A        BEQ              quit_skip
  315 000002C0         
  316 000002C0 EBFFFFFE        BL               output_character
  317 000002C4         
  318 000002C4 E350000D        CMP              r0, #0xD
  319 000002C8 0A000001        BEQ              key_enter
  320 000002CC         
  321 000002CC EBFFFFFE        BL               store_input
  322 000002D0         
  323 000002D0 EA000005        B                quit_skip
  324 000002D4         
  325 000002D4         key_enter
  326 000002D4         
  327 000002D4 E3A05000        MOV              r5, #0
  328 000002D8         



ARM Macro Assembler    Page 8 


  329 000002D8 E1A0800A        MOV              r8, r10
  330 000002DC         
  331 000002DC E3A0A000        MOV              r10, #0
  332 000002E0         
  333 000002E0 EBFFFFFE        BL               new_line
  334 000002E4         
  335 000002E4 E59F403C        LDR              r4, =test
  336 000002E8 EBFFFFFE        BL               output_string
  337 000002EC         
  338 000002EC         quit_skip
  339 000002EC         
  340 000002EC         FIQ_Exit
  341 000002EC         
  342 000002EC E8BD401F        LDMFD            SP!, {r0, r1, r2, r3, r4, lr}
  343 000002F0         
  344 000002F0 E25EF004        SUBS             pc, lr, #4
  345 000002F4         
  346 000002F4         
  347 000002F4         
  348 000002F4                 END
              00000000 
              E002C000 
              E000C004 
              FFFFF000 
              00008050 
              E01FC148 
              E0004018 
              00027100 
              E0004014 
              E0004004 
              E0004000 
              E01FC140 
              E000C008 
              00000000 
Command Line: --debug --xref --diag_suppress=9931 --apcs=interwork --depend=.\o
bjects\lab6.d -o.\objects\lab6.o -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\CMS
IS\Include -IC:\Keil_v5\ARM\INC\Philips --predefine="__EVAL SETA 1" --predefine
="__UVISION_VERSION SETA 524" --list=.\listings\lab6.lst lab6.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

EINT1 00000274

Symbol: EINT1
   Definitions
      At line 276 in file lab6.s
   Uses
      At line 186 in file lab6.s
Comment: EINT1 used once
FIQ_Exit 000002EC

Symbol: FIQ_Exit
   Definitions
      At line 340 in file lab6.s
   Uses
      At line 196 in file lab6.s
      At line 210 in file lab6.s
      At line 226 in file lab6.s
      At line 242 in file lab6.s
      At line 258 in file lab6.s
      At line 274 in file lab6.s
      At line 293 in file lab6.s
      At line 305 in file lab6.s

FIQ_Handler 000001A8

Symbol: FIQ_Handler
   Definitions
      At line 178 in file lab6.s
   Uses
      At line 5 in file lab6.s
Comment: FIQ_Handler used once
FIQ_Keys 00000294

Symbol: FIQ_Keys
   Definitions
      At line 295 in file lab6.s
   Uses
      At line 285 in file lab6.s
Comment: FIQ_Keys used once
TIMER0 000001C0

Symbol: TIMER0
   Definitions
      At line 188 in file lab6.s
   Uses
      At line 185 in file lab6.s
Comment: TIMER0 used once
cycle_1 000001F4

Symbol: cycle_1
   Definitions
      At line 212 in file lab6.s
   Uses
      At line 199 in file lab6.s
Comment: cycle_1 used once
cycle_2 00000214

Symbol: cycle_2
   Definitions



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

      At line 228 in file lab6.s
   Uses
      At line 202 in file lab6.s
Comment: cycle_2 used once
cycle_3 00000234

Symbol: cycle_3
   Definitions
      At line 244 in file lab6.s
   Uses
      At line 205 in file lab6.s
Comment: cycle_3 used once
cycle_4 00000254

Symbol: cycle_4
   Definitions
      At line 260 in file lab6.s
   Uses
      At line 208 in file lab6.s
Comment: cycle_4 used once
interrupt_init 00000100

Symbol: interrupt_init
   Definitions
      At line 63 in file lab6.s
   Uses
      At line 37 in file lab6.s
Comment: interrupt_init used once
interrupts 00000000

Symbol: interrupts
   Definitions
      At line 1 in file lab6.s
   Uses
      None
Comment: interrupts unused
key_enter 000002D4

Symbol: key_enter
   Definitions
      At line 325 in file lab6.s
   Uses
      At line 319 in file lab6.s
Comment: key_enter used once
lab6 000000C4

Symbol: lab6
   Definitions
      At line 30 in file lab6.s
   Uses
      At line 3 in file lab6.s
Comment: lab6 used once
lab6_end 000000F8

Symbol: lab6_end
   Definitions
      At line 55 in file lab6.s
   Uses
      At line 51 in file lab6.s



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Relocatable symbols

Comment: lab6_end used once
lab6_loop 000000EC

Symbol: lab6_loop
   Definitions
      At line 48 in file lab6.s
   Uses
      At line 53 in file lab6.s
Comment: lab6_loop used once
prompt 00000000

Symbol: prompt
   Definitions
      At line 26 in file lab6.s
   Uses
      At line 44 in file lab6.s
Comment: prompt used once
quit_skip 000002EC

Symbol: quit_skip
   Definitions
      At line 338 in file lab6.s
   Uses
      At line 311 in file lab6.s
      At line 314 in file lab6.s
      At line 323 in file lab6.s

test 000000BC

Symbol: test
   Definitions
      At line 27 in file lab6.s
   Uses
      At line 335 in file lab6.s
Comment: test used once
18 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

change_display 00000000

Symbol: change_display
   Definitions
      At line 11 in file lab6.s
   Uses
      None
Comment: change_display unused
change_display_digit 00000000

Symbol: change_display_digit
   Definitions
      At line 19 in file lab6.s
   Uses
      At line 222 in file lab6.s
      At line 238 in file lab6.s
      At line 254 in file lab6.s
      At line 270 in file lab6.s

clear_display 00000000

Symbol: clear_display
   Definitions
      At line 12 in file lab6.s
   Uses
      At line 38 in file lab6.s
      At line 214 in file lab6.s
      At line 230 in file lab6.s
      At line 246 in file lab6.s
      At line 262 in file lab6.s

from_ascii 00000000

Symbol: from_ascii
   Definitions
      At line 22 in file lab6.s
   Uses
      None
Comment: from_ascii unused
get_digit 00000000

Symbol: get_digit
   Definitions
      At line 20 in file lab6.s
   Uses
      At line 217 in file lab6.s
      At line 233 in file lab6.s
      At line 249 in file lab6.s
      At line 265 in file lab6.s

new_line 00000000

Symbol: new_line
   Definitions
      At line 17 in file lab6.s
   Uses
      At line 333 in file lab6.s
Comment: new_line used once
output_character 00000000



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
External symbols


Symbol: output_character
   Definitions
      At line 15 in file lab6.s
   Uses
      At line 316 in file lab6.s
Comment: output_character used once
output_string 00000000

Symbol: output_string
   Definitions
      At line 16 in file lab6.s
   Uses
      At line 46 in file lab6.s
      At line 336 in file lab6.s

pin_connect_block_setup_for_uart0 00000000

Symbol: pin_connect_block_setup_for_uart0
   Definitions
      At line 8 in file lab6.s
   Uses
      At line 35 in file lab6.s
Comment: pin_connect_block_setup_for_uart0 used once
read_character 00000000

Symbol: read_character
   Definitions
      At line 14 in file lab6.s
   Uses
      At line 307 in file lab6.s
Comment: read_character used once
setup_pins 00000000

Symbol: setup_pins
   Definitions
      At line 9 in file lab6.s
   Uses
      At line 36 in file lab6.s
Comment: setup_pins used once
store_input 00000000

Symbol: store_input
   Definitions
      At line 24 in file lab6.s
   Uses
      At line 321 in file lab6.s
Comment: store_input used once
toggle_seven_seg 00000000

Symbol: toggle_seven_seg
   Definitions
      At line 13 in file lab6.s
   Uses
      At line 287 in file lab6.s
Comment: toggle_seven_seg used once
uart_init 00000000

Symbol: uart_init



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
External symbols

   Definitions
      At line 7 in file lab6.s
   Uses
      At line 34 in file lab6.s
Comment: uart_init used once
validate_input 00000000

Symbol: validate_input
   Definitions
      At line 10 in file lab6.s
   Uses
      At line 308 in file lab6.s
Comment: validate_input used once
15 symbols
367 symbols in table
